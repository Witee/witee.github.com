<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="dns-prefetch" href="http://witee.github.io">
  <title>Witee&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Linux、React、ant-design">
<meta property="og:type" content="website">
<meta property="og:title" content="Witee&#39;s Blog">
<meta property="og:url" content="http://witee.github.io/index.html">
<meta property="og:site_name" content="Witee&#39;s Blog">
<meta property="og:description" content="Linux、React、ant-design">
<meta property="og:locale" content="zh">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Witee&#39;s Blog">
<meta name="twitter:description" content="Linux、React、ant-design">
  
    <link rel="alternative" href="/atom.xml" title="Witee&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="https://raw.githubusercontent.com/Witee/statics/master/blog/github.png">
  
  <link rel="stylesheet" href="/main.css">
  

</head>
</html>
<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="https://raw.githubusercontent.com/Witee/statics/master/blog/touxiang.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Witee</a></h1>
		</hgroup>

		
		<p class="header-subtitle">努力成为全栈工程师!</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/archives">所有文章</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
            
    			
            
    			
            
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/witee" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="http://weibo.com/witee" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="mail" target="_blank" href="mailto:525942866@qq.com" title="mail"><i class="icon-mail"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-sort"></i></div>
  		<h1 class="header-author js-mobile-header hide">Witee</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="https://raw.githubusercontent.com/Witee/statics/master/blog/touxiang.jpg" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Witee</h1>
			</hgroup>
			
			<p class="header-subtitle">努力成为全栈工程师!</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/witee" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/witee" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="mail" target="_blank" href="mailto:525942866@qq.com" title="mail"><i class="icon-mail"></i></a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-centos7使用privoxy配合shadowsocks翻墙" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/19/centos7使用privoxy配合shadowsocks翻墙/">centos7使用privoxy配合shadowsocks翻墙</a>
    </h1>
  

        <a href="/2019/02/19/centos7使用privoxy配合shadowsocks翻墙/" class="archive-article-date">
  	<time datetime="2019-02-19T06:48:12.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-02-19</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先，你需要一个<code>shadowsocks</code>帐号，用于翻墙。</p>
<p>然后我们在<code>centos</code>上安装<code>shadowsocks</code>软件。推荐通过pip安装。</p>
<p>很简单<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install python-pip</span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure></p>
<p>随后，我们配置好帐号密码，新建<code>/etc/shadowsocks.json</code>文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;server&quot;:&quot;your_server_ip&quot;,      #ss服务器IP</span><br><span class="line">    &quot;server_port&quot;:your_server_port, #端口</span><br><span class="line">    &quot;local_address&quot;: &quot;127.0.0.1&quot;,   #本地ip</span><br><span class="line">    &quot;local_port&quot;:1080,              #本地端口</span><br><span class="line">    &quot;password&quot;:&quot;your_server_passwd&quot;,#连接ss密码</span><br><span class="line">    &quot;timeout&quot;:300,                  #等待超时</span><br><span class="line">    &quot;method&quot;:&quot;rc4-md5&quot;,             #加密方式</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动：<code>sslocal -c /etc/shadowsocks.json</code></p>
<p>安装<code>Privoxy</code><br>直接使用yum安装即可 <code>yum install privoxy</code></p>
<p>安装好后，修改一下配置<code>vim /etc/privoxy/config</code></p>
<p>搜索<code>forward-socks5t</code>，将 <code>forward-socks5t / 127.0.0.1:9050  .</code> 取消注释并修改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forward-socks5t / 127.0.0.1:1080 .  # 注意最后有个点</span><br></pre></td></tr></table></figure>
<p>然后取消以下几行代码注释，本地网络不翻墙<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">forward         192.168.*.*/     .</span><br><span class="line">forward            10.*.*.*/     .</span><br><span class="line">forward           127.*.*.*/     .</span><br><span class="line"></span><br><span class="line">forward           localhost/     .</span><br></pre></td></tr></table></figure></p>
<p>启动privoxy <code>privoxy /etc/privoxy/config</code></p>
<p>配置/etc/profile<br>执行vim /etc/profile,添加如下二句:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export http_proxy=http://127.0.0.1:8118</span><br><span class="line">export https_proxy=http://127.0.0.1:8118</span><br></pre></td></tr></table></figure>
<p>修改后使配置生效 <code>source /etc/profile</code></p>
<p>执行<code>wget www.google.com</code>判断是否成功</p>
<p>如果不能访问，请重启机器，依次打开<code>shadowsocks</code>和<code>privoxy</code>再测试</p>
<p>备注：如果不需要用代理了，记得把<code>bash</code>里的配置注释上，免得把流量跑完了</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/centos7/">centos7</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/privoxy/">privoxy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shadowsocks/">shadowsocks</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2019/02/19/centos7使用privoxy配合shadowsocks翻墙/#more">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-使用-kubeadm-安装-kubernetes" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/19/使用-kubeadm-安装-kubernetes/">使用 kubeadm 安装 kubernetes(k8s)</a>
    </h1>
  

        <a href="/2019/02/19/使用-kubeadm-安装-kubernetes/" class="archive-article-date">
  	<time datetime="2019-02-19T02:51:24.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-02-19</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>服务器需要可以科学上网</p>
</blockquote>
<ul>
<li><p>安装 kubeadm</p>
<blockquote>
<p>请优先按官方安装文档安装: <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/" target="_blank" rel="noopener">https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/</a></p>
</blockquote>
<ul>
<li><p>使用阿里的YUM源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭 <code>selinux</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Set SELinux in permissive mode (effectively disabling it)</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i &apos;s/^SELINUX=enforcing$/SELINUX=permissive/&apos; /etc/selinux/config</span><br><span class="line"></span><br><span class="line">yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line">systemctl enable --now kubelet</span><br></pre></td></tr></table></figure>
<ul>
<li><p>加载模块 <code>br_netfilter</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep br_netfilter # centos 7 查询不到结果，看别人文档说已经编译进了某个地方，所以这一步可跳过</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>安装 <code>k8s</code></p>
<ul>
<li><p>提前加载镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull --image-repository=registry.aliyuncs.com/google_containers</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装 <code>k8s</code></p>
<blockquote>
<p>–pod-network-cidr=10.244.0.0/16 是因为后面要使用 Flannel 网络</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --image-repository=registry.aliyuncs.com/google_containers --pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure>
<p><code>init</code> 如果顺利完成，会提示执行几行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装<code>Flannel</code>网络</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure>
<p>通过 <code>kubectl get pods --all-namespaces</code> 检查是否已经全部为 <code>Running</code> 状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost k8s]# kubectl get pods --all-namespaces</span><br><span class="line">NAMESPACE     NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   coredns-78d4cf999f-677l2                     1/1     Running   0          5m7s</span><br><span class="line">kube-system   coredns-78d4cf999f-c6wng                     1/1     Running   0          5m7s</span><br><span class="line">kube-system   etcd-localhost                               1/1     Running   0          4m40s</span><br><span class="line">kube-system   kube-apiserver-localhost                     1/1     Running   0          4m26s</span><br><span class="line">kube-system   kube-controller-manager-localhost            1/1     Running   0          4m40s</span><br><span class="line">kube-system   kube-flannel-ds-amd64-rl8mq                  1/1     Running   0          26s</span><br><span class="line">kube-system   kube-proxy-lzb5p                             1/1     Running   0          5m7s</span><br><span class="line">kube-system   kube-scheduler-localhost                     1/1     Running   0          4m39s</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置master结点也可以分配 <code>pods</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes --all node-role.kubernetes.io/master-</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>添加 node 节点<br>请参考官网</p>
</li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/">k8s</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubeadm/">kubeadm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubernetes/">kubernetes</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2019/02/19/使用-kubeadm-安装-kubernetes/#more">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-MacOS环境下安装docker" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/24/MacOS环境下安装docker/">本文介绍在 macOS 上安装 docker</a>
    </h1>
  

        <a href="/2019/01/24/MacOS环境下安装docker/" class="archive-article-date">
  	<time datetime="2019-01-24T01:49:35.485Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-01-24</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>官方文档<br><a href="https://docs.docker.com/docker-for-mac/" target="_blank" rel="noopener">https://docs.docker.com/docker-for-mac/</a></p>
</blockquote>
<ul>
<li>下载 Docker for Mac</li>
</ul>
<p><img src="http://code.admaster.co/xieweiting/MeetingMaster/raw/master/docs/img/docker/1.png" alt=""></p>
<ul>
<li>安装<br>双击 Docker.dmg，然后把 Docker.app 移动到应用目录</li>
</ul>
<p><img src="http://code.admaster.co/xieweiting/MeetingMaster/raw/master/docs/img/docker/2.png" alt=""></p>
<ul>
<li>启动<br>应用目录中再次双击 Docker 即可启动</li>
</ul>
<p><img src="http://code.admaster.co/xieweiting/MeetingMaster/raw/master/docs/img/docker/3.png" alt=""></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mac/">mac</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/macOS/">macOS</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2019/01/24/MacOS环境下安装docker/#more">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-CentOS6-x环境下升级内核并安装-docker" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/24/CentOS6-x环境下升级内核并安装-docker/">本文介绍在 CentOS6.x 上安装 docker</a>
    </h1>
  

        <a href="/2019/01/24/CentOS6-x环境下升级内核并安装-docker/" class="archive-article-date">
  	<time datetime="2019-01-24T01:49:35.484Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-01-24</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>官方文档<br><a href="https://docs.docker.com/engine/installation/linux/centos/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/centos/</a></p>
</blockquote>
<ul>
<li><p>docker 需要64位系统且内核在3.10以上版本</p>
</li>
<li><p>安装前内核版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@serv ~]# uname -r</span><br><span class="line">2.6.32-220.el6.x86_64</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 yum 快速升级内核</p>
<ul>
<li><p>导入 Public Key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装 ELRepo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-6-6.el6.elrepo.noarch.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p>升级 Kernel</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --enablerepo=elrepo-kernel install kernel-lt -y</span><br></pre></td></tr></table></figure>
</li>
<li><p>更改 Grub</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/grub.conf</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>根据安装好以后的内核位置，修改 default 的值，一般是修改为0，因为 default 从 0 开始，一般新安装的内核在第一个位置，所以设置default=0</p>
<ul>
<li>查看 Kernel<br>所有操作都执行完毕以后，重启主机，重启后执行 uname -r，查看内核版本号，判断是否升级成功</li>
</ul>
</li>
<li><p>禁用selinux</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># getenforce</span><br><span class="line">enforcing</span><br><span class="line"># setenforce 0</span><br><span class="line">permissive</span><br><span class="line"># vi /etc/selinux/config</span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装 Fedora EPEL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装依赖及 docker-io</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install device-mapper-event-libs</span><br><span class="line">yum install docker-io</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker start</span><br></pre></td></tr></table></figure>
</li>
<li><p>日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tailf /var/log/docker</span><br></pre></td></tr></table></figure>
</li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/centos6/">centos6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2019/01/24/CentOS6-x环境下升级内核并安装-docker/#more">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-调整net.ipv4.tcp_tw_recycle造成的故障" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/24/调整net.ipv4.tcp_tw_recycle造成的故障/">调整 net.ipv4.tcp_tw_recycle 造成的故障</a>
    </h1>
  

        <a href="/2019/01/24/调整net.ipv4.tcp_tw_recycle造成的故障/" class="archive-article-date">
  	<time datetime="2019-01-24T01:49:35.481Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-01-24</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>背景</li>
</ul>
<blockquote>
<p>在 nat 的网络环境访问服务器时会有不定时连接超时的问题</p>
</blockquote>
<ul>
<li>原因</li>
</ul>
<p>出现此问题，可能是系统参数设置问题，即以下两个参数都设置为 1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_timestamps = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>RFC1323中有如下一段描述：</p>
</blockquote>
<blockquote>
<p>An additional mechanism could be added to the TCP, a per-host cache of the last timestamp received from any connection. This value could then be used in the PAWS mechanism to reject old duplicate segments from earlier incarnations of the connection, if the timestamp clock can be guaranteed to have ticked at least once since the old connection was open. This would require that the TIME-WAIT delay plus the RTT together must be at least one tick of the sender’s timestamp clock. Such an extension is not part of the proposal of this RFC.</p>
</blockquote>
<blockquote>
<p>大概意思是说TCP有一种行为，可以缓存每个主机最新的时间戳，后续请求中如果时间戳小于缓存的时间戳，即视为无效，相应的数据包会被丢弃。</p>
</blockquote>
<blockquote>
<p>Linux是否启用这种行为取决于tcp_timestamps和tcp_tw_recycle，因为tcp_timestamps缺省就是开启的，所以当tcp_tw_recycle被开启后，实际上这种行为就被激活了，当客户端或服务端以NAT方式构建的时候就可能出现问题，下面以客户端NAT为例来说明：</p>
</blockquote>
<blockquote>
<p>当多个客户端通过NAT方式联网并与服务端交互时，服务端看到的是同一个IP，也就是说对服务端而言这些客户端实际上等同于一个，可惜由于这些客户端的时间戳可能存在差异，于是乎从服务端的视角看，便可能出现时间戳错乱的现象，进而直接导致时间戳小的数据包被丢弃。如果发生了此类问题，具体的表现通常是是客户端明明发送的SYN，但服务端就是不响应ACK，我们可以通过下面命令来确认数据包不断被丢弃的现象：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; netstat -s | grep timestamp</span><br><span class="line">... packets rejects in established connections because of timestamp</span><br></pre></td></tr></table></figure>
<blockquote>
<p>安全起见，通常要禁止tcp_tw_recycle。说到这里，大家可能会想到另一种解决方案：把tcp_timestamps设置为0，tcp_tw_recycle设置为1，这样不就可以鱼与熊掌兼得了么？可惜一旦关闭了tcp_timestamps，那么即便打开了tcp_tw_recycle，也没有效果。</p>
</blockquote>
<blockquote>
<p>引用地址: <code>https://huoding.com/2012/01/19/142</code></p>
</blockquote>
<ul>
<li><p>解决办法</p>
<p>解决的方法就是将这两个参数修改为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_timestamps = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>遇到的问题</p>
<p>本来修改完成后再次请求就没有问题了，但如果是 docker 服务器的话，会发现容器中无法连接网络!</p>
<p>因为修改 <code>net.ipv4.tcp_tw_recycle</code> 影响的是 nat 相关，所以如果容器是以 nat 方式上网的话，就会造成影响</p>
</li>
<li><p>解决办法</p>
<p>解决以上问题，需要先停掉 docker 主进程，然后修改参数，再启动</p>
</li>
</ul>
<p>-</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tcp/">tcp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tcp-timestamps/">tcp_timestamps</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tcp-tw-recycle/">tcp_tw_recycle</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2019/01/24/调整net.ipv4.tcp_tw_recycle造成的故障/#more">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Docker-Compose安装" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/24/Docker-Compose安装/">Docker Compose 安装</a>
    </h1>
  

        <a href="/2019/01/24/Docker-Compose安装/" class="archive-article-date">
  	<time datetime="2019-01-24T01:49:35.476Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-01-24</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Docker Compose 用来批量管理 Docker容器<br>官方文档 <code>https://docs.docker.com/compose/install/</code></p>
</blockquote>
<blockquote>
<p>注意，CentOS 6.x 上就算安装成功了也不能使用，因为Docker Compose需要Docker engine版本<br>为1.10 以上，而 CentOS6 上最多能装 1.7版本。<br>所以以下文档看看就算了。。。</p>
</blockquote>
<ul>
<li><p>Mac 与 Windows 上的 docker 已经自带了 Compose</p>
</li>
<li><p>CentOS 6.x 安装 Docker Compose</p>
</li>
<li><p>打开 URL</p>
<p>官方发布的版本中有安装方法，打开以下地址，从最新版本中复制</p>
<p><code>https://github.com/docker/compose/releases</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">If you&apos;re a Mac or Windows user, the best way to install Compose and keep it up-to-date is Docker for Mac and Windows.</span><br><span class="line"></span><br><span class="line">Note that Compose 1.10.0-rc2 requires Docker Engine 1.10.0 or later for version 2 of the Compose File format, and Docker Engine 1.9.1 or later for version 1. Docker for Mac and Windows will automatically install the latest version of Docker Engine for you.</span><br><span class="line"></span><br><span class="line">Alternatively, you can use the usual commands to install or upgrade Compose:</span><br><span class="line"></span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/1.10.0-rc2/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br><span class="line">See the install docs for more install options and instructions.</span><br></pre></td></tr></table></figure>
<p>所以是执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/docker/compose/releases/download/1.10.0-rc2/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>
</li>
<li><p>确认完成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果以上安装不成功，可以使用 <code>pip</code> 进行安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install docker-compose</span><br></pre></td></tr></table></figure>
</li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/compose/">compose</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2019/01/24/Docker-Compose安装/#more">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-hello-world" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/24/hello-world/">Hello World</a>
    </h1>
  

        <a href="/2019/01/24/hello-world/" class="archive-article-date">
  	<time datetime="2019-01-24T01:49:35.474Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-01-24</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello world!</span><br></pre></td></tr></table></figure>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hello/">Hello</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/World/">World</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2019/01/24/hello-world/#more">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-CentOS7-x环境下安装docker" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/24/CentOS7-x环境下安装docker/">本文介绍在 CentOS7.x 上安装 docker</a>
    </h1>
  

        <a href="/2019/01/24/CentOS7-x环境下安装docker/" class="archive-article-date">
  	<time datetime="2019-01-24T01:49:35.473Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-01-24</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>官方文档<br><a href="https://docs.docker.com/engine/installation/linux/centos/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/centos/</a></p>
</blockquote>
<ul>
<li>docker 需要64位系统且内核在3.10以上版本</li>
</ul>
<p>CentOS7 已满足最低要求</p>
<ul>
<li><p>添加 yum 源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># tee /etc/yum.repos.d/docker.repo &lt;&lt;-&apos;EOF&apos;</span><br><span class="line">[dockerrepo]</span><br><span class="line">name=Docker Repository</span><br><span class="line">baseurl=https://yum.dockerproject.org/repo/main/centos/7/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://yum.dockerproject.org/gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-engine</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>
</li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/centos7/">centos7</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2019/01/24/CentOS7-x环境下安装docker/#more">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-elasticsearch创建mapping" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/23/elasticsearch创建mapping/">elasticsearch 创建 mapping</a>
    </h1>
  

        <a href="/2019/01/23/elasticsearch创建mapping/" class="archive-article-date">
  	<time datetime="2019-01-23T09:26:20.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-01-23</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p>查看当前ES中有哪些索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[GET] http://localhost:9200/_cat/indices</span><br><span class="line"></span><br><span class="line">返回:</span><br><span class="line">  &#123;</span><br><span class="line">      &quot;acknowledged&quot;: true,</span><br><span class="line">      &quot;shards_acknowledged&quot;: true,</span><br><span class="line">      &quot;index&quot;: &quot;inde_name&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建索引（index）（mysql-库）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[PUT] http://localhost:9200/inde_name</span><br><span class="line"></span><br><span class="line">返回:</span><br><span class="line">  &#123;</span><br><span class="line">      &quot;acknowledged&quot;: true,</span><br><span class="line">      &quot;shards_acknowledged&quot;: true,</span><br><span class="line">      &quot;index&quot;: &quot;inde_name&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[GET] http://localhost:9200/inde_name/_mapping</span><br><span class="line"></span><br><span class="line">返回:</span><br><span class="line">  &#123;</span><br><span class="line">      &quot;inde_name&quot;: &#123;</span><br><span class="line">          &quot;mappings&quot;: &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建类型（type）（mysql-表）的同时创建创建映射（mapping）（mysql-字段）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[POST] http://localhost:9200/inde_name/_mapping/fans</span><br><span class="line"></span><br><span class="line">body:</span><br><span class="line">  &#123;</span><br><span class="line">      &quot;dynamic&quot;: &quot;false&quot;,</span><br><span class="line">      &quot;_all&quot;: &#123;</span><br><span class="line">          &quot;enabled&quot;: false</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;_parent&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;kol&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;_routing&quot;: &#123;</span><br><span class="line">          &quot;required&quot;: true</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">          &quot;fansAge&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;fansCity&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;fansCityLevel&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;fansGender&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;fansInterests&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;fansKolUid&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;fansLocation&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;fansProvince&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;fansUid&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">返回:</span><br><span class="line">  &#123;</span><br><span class="line">      &quot;acknowledged&quot;: true,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>再次查看索引</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[GET] http://localhost:9200/inde_name/_mapping</span><br><span class="line"></span><br><span class="line">返回:</span><br><span class="line">  &#123;</span><br><span class="line">      &quot;inde_name&quot;: &#123;</span><br><span class="line">          &quot;mappings&quot;: &#123;</span><br><span class="line">              &quot;fans&quot;: &#123;</span><br><span class="line">                  &quot;dynamic&quot;: &quot;false&quot;,</span><br><span class="line">                  &quot;_all&quot;: &#123;</span><br><span class="line">                      &quot;enabled&quot;: false</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &quot;_parent&quot;: &#123;</span><br><span class="line">                      &quot;type&quot;: &quot;kol&quot;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &quot;_routing&quot;: &#123;</span><br><span class="line">                      &quot;required&quot;: true</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &quot;properties&quot;: &#123;</span><br><span class="line">                      &quot;fansAge&quot;: &#123;</span><br><span class="line">                          &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">                      &#125;,</span><br><span class="line">                      &quot;fansCity&quot;: &#123;</span><br><span class="line">                          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">                      &#125;,</span><br><span class="line">                      &quot;fansCityLevel&quot;: &#123;</span><br><span class="line">                          &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">                      &#125;,</span><br><span class="line">                      &quot;fansGender&quot;: &#123;</span><br><span class="line">                          &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">                      &#125;,</span><br><span class="line">                      &quot;fansInterests&quot;: &#123;</span><br><span class="line">                          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">                      &#125;,</span><br><span class="line">                      &quot;fansKolUid&quot;: &#123;</span><br><span class="line">                          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">                      &#125;,</span><br><span class="line">                      &quot;fansLocation&quot;: &#123;</span><br><span class="line">                          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">                      &#125;,</span><br><span class="line">                      &quot;fansProvince&quot;: &#123;</span><br><span class="line">                          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">                      &#125;,</span><br><span class="line">                      &quot;fansUid&quot;: &#123;</span><br><span class="line">                          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/es/">es</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mapping/">mapping</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2019/01/23/elasticsearch创建mapping/#more">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-elasticsearch常用命令" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/23/elasticsearch常用命令/">elasticsearch 常用命令</a>
    </h1>
  

        <a href="/2019/01/23/elasticsearch常用命令/" class="archive-article-date">
  	<time datetime="2019-01-23T06:46:39.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-01-23</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>以下查询样例均在 <code>ES 5.6.1</code> 版本进行</p>
</blockquote>
<ul>
<li><p>下载样例数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Witee/statics/blob/master/blog/elasticsearch/example-data/accounts.json</span><br></pre></td></tr></table></figure>
</li>
<li><p>写入 ES</p>
<blockquote>
<p>自动创建了索引 <code>bank</code>，类型 <code>account</code>，使用<code>bulk</code>接口批量操作</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST &apos;localhost:9200/bank/account/_bulk?pretty&apos; --data-binary  @accounts.json</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl &apos;localhost:9200/_cat/indices?v&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>普通查询</p>
<blockquote>
<ul>
<li>匹配所有；</li>
<li>按 <code>account_number</code> 升序；</li>
<li>从第 3 条记录开始（注意这里的 <code>from</code> 不表示页码）；</li>
<li>每页显示 2 条；</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: &#123;</span><br><span class="line">    &quot;account_number&quot;: &#123;&quot;order&quot;: &quot;asc&quot;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 3,</span><br><span class="line">  &quot;size&quot;: 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sort</code> 可以写多条</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;sort&quot;: [</span><br><span class="line">  &#123;&quot;balance&quot;: &#123;&quot;order&quot;: &quot;desc&quot;&#125; &#125;,</span><br><span class="line">  &#123;&quot;account_number&quot;: &#123;&quot;order&quot;: &quot;asc&quot;&#125; &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><code>_source</code> 中指定返回字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;_source&quot;: [&quot;account_number&quot;, &quot;balance&quot;]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p><code>match</code> 会对查询关键词先进行分词，再查询</p>
</blockquote>
<p>  <code>address</code> 包含 <code>mill</code> 或 <code>lane</code>，不区分大小写<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;mill lane&quot; &#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>  <code>address</code> 包含 <code>mill</code> 且 <code>lane</code>，不区分大小写<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_phrase&quot;: &#123; &quot;address&quot;: &quot;mill lane&quot; &#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/es/">es</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2019/01/23/elasticsearch常用命令/#more">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2019 Witee
    	</div>
      	<div class="footer-right">
          <script language="javascript" type="text/javascript" src="http://js.users.51.la/19050737.js"></script>
          <noscript>
            <a href="http://www.51.la/?19050737" target="_blank">
              <img alt="&#x6211;&#x8981;&#x5566;&#x514D;&#x8D39;&#x7EDF;&#x8BA1;" src="http://img.users.51.la/19050737.asp" style="border:none">
            </a>
          </noscript>
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>

    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: false
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
    
    
    
  </ul>
  <div class="tools-wrap">
    

    

    

    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>